---
title: "ArcGIS vs. QGIS"
description: |
  A short description of the post.
date: 2022-02-07
draft: true
format:
  html:
    code-fold: true
execute: 
  warning: false
---

What GIS Software should we teach our students? This is a question we ask ourselves, especially if we created new courses or rewrite old ones. Till recently, we used ESRI products in all our courses. However in the recent years, we've started using QGIS more often. The question is often: Which software do students *need* if they start working in the industry or in academia? 

In the search of data to answer this question, I've found two interesting sources:

1. The tags from gis.stackexchange.com (downloaded [here](https://archive.org/details/stackexchange) on the 17.11.2022)
2. Google Trends search data (downloaded [here](https://trends.google.com/trends/explore?date=all&geo=CH&q=%2Fm%2F082gc5,QGIS) on the 17.11.2022)


```{r}
#| code-summary: loading necessary libraries

library(here)
library(tidyverse)
library(lubridate)
library(ggfx)
library(ggtext)
library(ragg)
library(colorspace)

```


```{r}
#| code-summary: Visualizing data from gis.stackexchange
gis_stackexchange_tags <- read_csv(here("blog","2022-11-30-ArcGIS-vs-QGIS", "gis.stackexchange-tags.csv"))

arcgis_pa <- gis_stackexchange_tags |>
  mutate(year = year(CreationDate)) |>
  filter(year < 2022) |>
  group_by(year, group) |>
  count()

arcgis_qgis_roll <- gis_stackexchange_tags |>
  mutate(month = as.Date(lubridate::round_date(CreationDate, "month"))) |> 
  group_by(group, month) |>
  count() |>
  group_by(group) |>
  mutate(roll = zoo::rollmean(n, 12, align = "left", fill = NA)) |>
  filter(!is.na(roll)) |>
  ungroup() |>
  complete(group, month, fill = list(n = 0, roll = 0))




arcgis_qgis_wide <- arcgis_qgis_roll |>
  group_by(month) |>
  summarise(
    min = min(roll),
    max = max(roll),
    diff = max - min,
    group = group[which.max(roll)]
  )


# https://coolors.co/palette/ef476f-ffd166-06d6a0-118ab2-073b4c
cols <- c(arcgis = "#06d6a0", qgis = "#ef476f")
bgcol <- "#073b4c"


get_first <- function(vec, comp){
  comps <- vec >= comp
  if(!any(comps)){
    length(comps)
  }else{
    min(which(comps))
  }
}

vlines <- tibble(y =  seq(0, 600, 100), xend = arcgis_qgis_roll$month[map_int(y, ~get_first(arcgis_qgis_roll$roll, .x))], x = rep(min(arcgis_qgis_roll$month),length(y)))
```


```{r}
#| column: page
#| fig-width: 12
#| fig-height: 6

ggplot(arcgis_qgis_roll, aes(month, roll, color = group)) +
  geom_ribbon(
    data = arcgis_qgis_wide,
    aes(x = month, ymin = min, ymax = max, color = group,
        fill = after_scale(darken(desaturate(color, .1), .4, space = "HLS"))),
    alpha = .7, inherit.aes = FALSE
  ) +
  with_blur(
    geom_line(data = ~filter(., group == "arcgis"), 
              color = cols[1], size = 2.5),
    colour = lighten(cols[1], .1), sigma = 3
  ) +
  with_blur(
    geom_line(data = ~filter(., group == "qgis"), 
              color = cols[2], size = 2.5),
    colour = lighten(cols[2], .1), sigma = 3
  )  +
  geom_line(size = 1.5) +
  geom_richtext(
    aes(x = as.Date("2015-06-01"), y = 700,
        label = glue::glue("Monthly <span style='font-family:cinzel;'><b style='color:{cols['arcgis']};font-size:30pt;'>[ArcGIS]</b> & <b style='color:{cols['qgis']};font-size:30pt;'>[QGIS]</b></span> Questions on gis.stackoverflow.com")),
    color = "grey80", size = 7, lineheight = 1.5, family = "Work Sans",
    stat = "unique", fill = NA, label.color = NA
  )  +
  annotate("text", x = as.Date("2015-01-27"), y = 620,vjust = .5, hjust = .5,
             label = "ESRI realeases\nArcGIS Pro 1.0",
             family = "Chivo",
           colour = cols["arcgis"],
             size = 3.8,
             lineheight = .9) +
  geom_segment(aes(x = as.Date("2015-01-27"), xend = as.Date("2015-01-27"), 
                   y = 530, yend = 600),colour = cols["arcgis"]) +
  annotate("text", x = as.Date("2016-10-15"), y = 620,vjust = .5, hjust = .5,
             label = "No. of QGIS Tags\nsurpasses ArcGIS",
             family = "Chivo",
           colour = cols["qgis"],
             size = 3.8,
             lineheight = .9) +
  geom_segment(aes(x = as.Date("2016-10-15"), xend = as.Date("2016-10-15"), 
                   y = 430, yend = 600),colour = cols["qgis"]) +
  geom_segment(data = vlines, aes(x = x, xend = xend, y = y, yend = y), inherit.aes = FALSE,  color = "grey50", linetype = "13") +
  geom_segment(data = filter(arcgis_qgis_wide, month(month) == 1), aes(x = month, xend = month, y = 0, yend = min-10), color = "grey50", linetype = "13") +
  scale_x_date(date_breaks = "year", date_labels = "%Y", expand = c(0, 0))  +
  scale_y_continuous(breaks = vlines$y) +
  scale_color_manual(values = cols) +
  theme_void() +
  theme(
    panel.background = element_rect(fill = "transparent", color = "transparent"),
    plot.background = element_rect(fill = bgcol),
    axis.text = element_text(family = "Cinzel", color = "grey80",
                               size = 10, face = "bold", margin = margin(t = 6)),
    panel.grid.major.x = element_blank(),
    plot.margin = margin(15, 30, 10, 30),
    plot.caption = element_text(family = "Work Sans", color = "grey50", size = 8,
                                hjust = .5, margin = margin(t = 30, b = 0)),
    legend.position = "none"
  )
```



```{r}
#| code-summary: Visualizing data from Google Trends
google_trends_ch <- read_csv(here("blog","2022-11-30-ArcGIS-vs-QGIS", "google-trends-CH.csv"),skip = 1)
google_trends_world <- read_csv(here("blog","2022-11-30-ArcGIS-vs-QGIS", "google-trends-World.csv"),skip = 1)

google_trends_world$`QGIS: (Worldwide)` <- parse_number(google_trends_world$`QGIS: (Worldwide)`)

google_trends <- full_join(google_trends_ch, google_trends_world) |>  
  pivot_longer(-Month) |> 
  extract(name, c("Software", "Region"), regex = "(\\w+):\\s\\((\\w+)\\)") |> 
  mutate(Month = as.POSIXct(paste0(Month,"-1"), format = "%Y-%m-%d"))

google_trends_roll <- google_trends |> 
  group_by(Software, Region) |> 
  mutate(roll = zoo::rollmean(value, 12, align = "left", fill = NA)) |>
  filter(!is.na(roll)) |>
  ungroup() |>
  complete(Software, Region, fill = list(value = 0, roll = 0))





ggplot(google_trends, aes(Month, value, colour = Software)) +
  geom_smooth() +
  geom_point(alpha = .2) +
  facet_wrap(~Region, ncol = 1) +
  theme(legend.position = "bottom")
```


```{r}
ggplot(filter(google_trends_roll, Region == "Switzerland"), aes(Month, roll, color = Software)) +
  with_blur(
    geom_line(data = ~filter(., Software == "ArcGIS"), 
              color = cols[1], size = 2.5),
    colour = lighten(cols[1], .1), sigma = 3
  ) +
  with_blur(
    geom_line(data = ~filter(., Software == "QGIS"), 
              color = cols[2], size = 2.5),
    colour = lighten(cols[2], .1), sigma = 3
  ) +
  theme_void() +
  geom_richtext(
    aes(x = as.POSIXct("2013-01-01"), y = 50,
        label = glue::glue("Monthly <span style='font-family:cinzel;'><b style='color:{cols['arcgis']};font-size:30pt;'>[ArcGIS]</b> & <b style='color:{cols['qgis']};font-size:30pt;'>[QGIS]</b></span> Questions on gis.stackoverflow.com")),
    color = "grey80", size = 7, lineheight = 1.5, family = "Work Sans",
    stat = "unique", fill = NA, label.color = NA
  ) +
  labs("Monthly Searches for QGIS and ArcGIS Terms on Google Trends") +
  theme(
    panel.background = element_rect(fill = "transparent", color = "transparent"),
    plot.background = element_rect(fill = bgcol),
    axis.text = element_text(family = "Cinzel", color = "grey80",
                               size = 10, face = "bold", margin = margin(t = 6)),
    panel.grid.major.x = element_blank(),
    plot.margin = margin(15, 30, 10, 30),
    plot.caption = element_text(family = "Work Sans", color = "grey50", size = 8,
                                hjust = .5, margin = margin(t = 30, b = 0)),
    legend.position = "none"
  )
```


