


?sf_project
options(digits = 10)

library(purrr)

origin <- matrix(c(722758.81,87649.67),ncol = 2)
origin <- matrix(c(615499.74, 206249.97), ncol = 2)

strange <- function(origin){sf::sf_project(st_crs(21781),st_crs(2056),pts = origin)- c(2e6, 1e6)}

function(origin){
  dos <- origin - strange(origin)
  rad <- atan2(dos[1], dos[2])
  }


strange_recursion <- function(n, init){do.call("rbind", accumulate(1:n, function(y,z){strange(y)}, .init = init))}


or <- strange_recursion(100000, origin)


or_sf <- st_sfc(st_linestring(or), crs = 21781)

tm_shape(or_sf) + tm_lines()

ggplot(or_sf) + geom_sf()

gri <- st_coordinates(st_make_grid(landesgebiet, 10000, what = "centers"))

gri <- gri[sample(nrow(gri), 10), ]

ou <- apply(gri, 1, function(x){strange_recursion(4, init = matrix(x, ncol = 2, byrow = TRUE))})



map(ou, 1, function(x){matrix(x, ncol = 2)})

ncol_h <- (ncol(ou)/2)
map(1:ncol_h, function(x){
  ou[,c(x,(x+ncol_h))]
}) %>% 
  do.call("rbind", .)


str(ddf)

strange_recursion(10, origin)


split(gri, seq_len(nrow(gri))) %>%
  map(function(x){
    x <- matrix(x, ncol = 2, byrow = TRUE)
    accumulate(1:10, function(y, z){strange(y)}, .init = x) %>%
      do.call("rbind", .)
  })
  
  


ggplot(as_tibble(gri), aes(X, Y)) +
  geom_point() +
  coord_equal()

origin <- new - c(2e6, 1e6)

