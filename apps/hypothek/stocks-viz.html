<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
</head>

<body>
  <div id="vis" />
  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "data": { "url": "stocks.csv" },
      "width": 400,
      "height": 300,
      "encoding": { "x": { "field": "date", "type": "temporal" } },
      "layer": [
        {
          "encoding": {
            "color": { "field": "symbol", "type": "nominal" },
            "y": { "field": "price", "type": "quantitative" }
          },
          "layer": [
            { "mark": "line" },
            {
              "transform": [{ "filter": { "param": "hover", "empty": false } }],
              "mark": "point"
            }
          ]
        },
        {
          "transform": [{ "pivot": "symbol", "value": "price", "groupby": ["date"] }],
          "mark": "rule",
          "encoding": {
            "opacity": {
              "condition": { "value": 0.3, "param": "hover", "empty": false },
              "value": 0
            },
            // the following is responsile for the infobox
            // "tooltip": [
            // { "field": "AAPL", "type": "quantitative" },
            // { "field": "AMZN", "type": "quantitative" },
            // { "field": "GOOG", "type": "quantitative" },
            // { "field": "IBM", "type": "quantitative" },
            // { "field": "MSFT", "type": "quantitative" }
            // ]
          },
          "params": [
            {
              "name": "hover",
              "select": {
                "type": "point",
                "fields": ["date"],
                "nearest": true,
                "on": "mouseover",
                "clear": "mouseout"
              }
            }
          ]
        }
      ],
      "config": {}
    };
    vegaEmbed("#vis", spec, { mode: "vega-lite" }).then(console.log).catch(console.warn);
  </script>
</body>

</html>